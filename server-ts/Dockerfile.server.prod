FROM node:22-slim AS build

WORKDIR /workdir/app

RUN npm install -g pnpm

COPY package.json pnpm-lock.yaml /workdir
COPY ./server-ts/package.json ./server-ts/esbuild.config.ts /workdir/app
RUN pnpm install --filter @daiius/girls-side-analysis-server-ts

COPY ./server-ts/src/ /workdir/app/src/

RUN pnpm build


FROM gcr.io/distroless/nodejs22:debug

WORKDIR /app

COPY ./server-ts/package.json /app
COPY --from=build /workdir/app/dist/index.js /app/index.js
CMD ["index.js"]

